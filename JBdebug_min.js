"use strict";function _classCallCheck(c,d){if(!(c instanceof d))throw new TypeError("Cannot call a class as a function")}var Vector=function(){function c(){var d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];_classCallCheck(this,c),this.array=e,this.shape=0<d.length?d:this.calc_shape(this.array),this.size=this.calc_size(this.shape),this.dim=this.find_dim(),this.flat=[],this.flatten(this.array)}return c.array=function array(d){return new c([],d)},c.zeroes=function zeroes(d){var e;if(1==d.length)e=c.fill(d[0],0);else for(var f=c.fill(d[d.length-1],0),g=d.length-2;0<=g;g--){e=[];for(var h=0;h<d[g];h++)e.push(f);f=e}return new c(d,e)},c.add=function add(d,e){if(d.shape===e.shape){for(var f=[],g=0;g<d.flat.length;g++)f[g]=d.flat[g]+e.flat[g];var h=new c(d.shape);return h.arrange(f),h}return new Error("Unequal Size")},c.fill=function fill(d){for(var q=arguments.length,e=Array(1<q?q-1:0),r=1;r<q;r++)e[r-1]=arguments[r];var g,f=[];if(!e||0===e.length)for(g=0;g<d;g++)f[g]=Math.random();else if(1!==e.length){var o=min=e[0],p=e[1];for(g=0;g<d;g++)f[g]=o++,o>p&&(o=min)}else if(Array.isArray(e[0])){var h=0;for(g=0;g<d;g++)f[g]=e[0][h++],h>=e[0].length&&(h=0)}else for(g=0;g<d;g++)f[g]=e[0];return f},c.prototype.find_dim=function find_dim(){return this.shape.length},c.prototype.calc_shape=function calc_shape(d){for(var e=[d.length],f=d[0];Array.isArray(f);)e.push(f.length),f=f[0];return e},c.prototype.calc_size=function calc_size(d){for(var e=1,g=d,h=Array.isArray(g),o=0,g=h?g:g[Symbol.iterator]();;){var p;if(h){if(o>=g.length)break;p=g[o++]}else{if(o=g.next(),o.done)break;p=o.value}var f=p;e*=f}return e},c.prototype.flatten=function flatten(d){for(var f=d,g=Array.isArray(f),h=0,f=g?f:f[Symbol.iterator]();;){var o;if(g){if(h>=f.length)break;o=f[h++]}else{if(h=f.next(),h.done)break;o=h.value}var e=o;Array.isArray(e)?this.flatten(e):this.flat.push(e)}},c.prototype.arrange=function arrange(d){var e=this.dim,f=this.shape[e-1],g=[],h=1,o=0;2<=e&&(h=this.shape[e-2]);for(var p=0;p<h;p++)if(d){for(var q=[],r=0;r<f;r++)q[r]=d[o++],o>=d.length&&(o=0);g.push(c.fill(f,q))}else g.push(c.fill(f));this.array=g,this.flatten(this.array)},c.prototype.reshape=function reshape(d){if(this.calc_size(d)===this.size){var e=this.flat;this.shape=d,this.dim=this.find_dim(),this.arrange(e)}else return new Error("Resizing error : can't change the size")},c.prototype.resize=function resize(d){var e=this.flat;this.shape=d,this.size=this.calc_size(this.shape),this.dim=this.find_dim(),this.arrange(e)},c.prototype.transpose=function transpose(){},c}();function product(c,d){console.log("arg1 = "+c+", arg2 = "+d);var f;if(Array.isArray(d)){var g=0;if(c.length===d.length)f=[],c.forEach(function(h){Array.isArray(h)?f.push(product(h,d[g++])):f.push(h*d[g++])});else throw new Error("Uneven size!")}else f=[],c.forEach(function(h){Array.isArray(h)?f.push(product(h,d)):f.push(h*d)});return console.log("product = "+f),f}function sum(c,d){var e,f;if(!d){for(f=0,e=0;e<c.length;e++)f+=c[e];return f}else if(Array.isArray(d)){if(c.length===d.length){for(f=[],e=0;e<c.length;e++)f[e]=c[e]+d[e];return f}throw new Error("Uneven size!")}else{for(f=[],e=0;e<c.length;e++)f[e]=c[e]+d;return f}}var Network=function(){function c(d){_classCallCheck(this,c),this.net_config=d,this.lyrs_count=this.net_config.length,this.weights=[],this.biases=[],this.Z=[];for(var e=1;e<this.lyrs_count;e++)this.weights.push(lyr(this.net_config[e],this.net_config[e-1])),this.biases.push(lyr(this.net_config[e]))}return c.prototype.fit=function fit(d,e){var f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0.5,o=this,g=3<arguments.length&&void 0!==arguments[3]?arguments[3]:400,h=4<arguments.length&&void 0!==arguments[4]?arguments[4]:10;this.input=d,this.labels=e,this.activations=[],this.input.forEach(function(p){o.activations.push(o.feed_forward(p))}),this.SGD(f,g,h)},c.prototype.feed_forward=function feed_forward(d){var e=[],f=[];e.push(d);for(var g=1;g<this.lyrs_count;g++){console.log("Layer No.: "+g);for(var h=[],o=[],p=0;p<this.net_config[g];p++)h.push(sigmoid_function(o[p]=weighted_input(this.weights[g-1],e[g-1],this.biases[g-1],p)));e.push(h),f.push(o)}return this.Z.push(f),e},c.prototype.SGD=function SGD(d,e,f){for(var g=e;0<e;){console.log("Epoch "+(g-e));for(var p,h=Math.round(Math.random()*(this.input.length-1)),o=0;o<f;){p=this.backprop(h),h++,h>=this.input.length&&(h=0);var q=p[0],r=p[1];console.log("delw after backprop = "+q[0].array);for(var s=1;s<this.lyrs_count;s++)console.log("delw just before sgd = "+q[s-1].array),console.log("delw.flat = "+q[s-1].flat),console.log("neta/m = "+-(d/f)),console.log("product with neta/m =  "+product(q[s-1].flat,-d/f)),q[s-1].arrange(product(q[s-1].flat,-(d/f))),console.log("delw just after sgd = "+q[s-1].array),r[s-1].arrange(product(r[s-1].flat,-(d/f)));console.log("delw after SGD = "+q[0].array);for(var t=1;t<this.lyrs_count;t++)console.log("delw = "+q[t-1].array),console.log("delw.shape = "+q[t-1].shape+" , w.shape = "+this.weights[t-1].shape),this.weights[t-1].arrange(Vector.add(this.weights[t-1],q[t-1])),this.biases[t-1].arrange(Vector.add(this.biases[t-1],r[t-1])),console.log("weights after update = "+this.weights[t-1].array);o++}e--}},c.prototype.backprop=function backprop(d){for(var p=[],q=[],s=1;s<this.lyrs_count;s++)p.push(Vector.zeroes(this.weights[s-1].shape)),q.push(Vector.zeroes(this.biases[s-1].shape));var t=[],u=[];this.Z[d][this.lyrs_count-2].forEach(function(D){u.push(sigma_dash(D))});var e=cost_grad.call(this,this.activations[d][this.lyrs_count-1],this.labels[d]),A=product(u,e);t[this.lyrs_count-1]=A;for(var f,B=this.lyrs_count-2;1<=B;B--){f=t[B+1],1==t[B+1].length&&(f=t[B+1][0]);var g=product(this.weights[B-1].array,f);console.log("weights for layer "+B+" = "+this.weights[B-1].array),console.log("delta for l+1 layer = "+f),console.log("w(l+1).del(l+1) = "+g);var C=product(g,this.Z[d][B-1]);console.log("partErr.sigma'(z(l)) = "+C),console.log("Error terms in layer "+B+" = "+C),t[B]=C}for(var h=1;h<this.lyrs_count;h++)for(var o=0;o<this.net_config[h];o++)p[h-1].array[o]=product(this.activations[d][h-1],t[h][o]),q[h-1].array[o]=t[h][o];return r[0]=p,r[1]=q,r},c.prototype.predict=function predict(d){var e=this.feed_forward(d,0);return e[this.lyrs_count-1]},c}();function lyr(c,d){var e,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return d?1===f?(e=new Vector([c,d]),e.arrange()):e=Vector.zeroes([c,d]):1===f?(e=new Vector([c]),e.array=Vector.fill(c)):e=Vector.zeroes([c]),e}function sigmoid_function(c){return 1+Math.exp(-c)}function weighted_input(c,d,e,f){var g=sum(product(c.array[f],d))+e.array[f];return console.log("z for "+f+"th neuron is "+g),g}function cost_grad(c,d){for(var e=0;e<d.length;e++)d[e]=-d[e];var f=sum(c,d);return f}function sigma_dash(c){return sigmoid_function(c)*(1-sigmoid_function(c))}var test_net=new Network([3,2,1]),train_features=[[10,24,5],[15,20,6],[1,2,3]],train_labels=[1,0,0];test_net.fit(train_features,train_labels,0.5,10,2);var pred=test_net.predict([10,8,2]);console.log(pred);
